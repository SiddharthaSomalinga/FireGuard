<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FireGuard - Wildfire Risk Assessment</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div>
                    <h1>üî• FireGuard</h1>
                    <p class="subtitle">Real-Time Wildfire Risk Assessment System</p>
                </div>
                <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
                    <span class="theme-icon">üåô</span>
                </button>
            </div>
        </header>

        <main>
            <div class="input-section">
                <h2>Enter Location</h2>
                <button type="button" id="useLocationBtn" class="btn-secondary">üìç Use My Location</button>
                
                <div class="presets-section">
                    <p class="presets-label">Quick Presets (USA Wildfire Zones):</p>
                    <div class="presets-grid">
                        <button type="button" class="preset-btn" data-lat="34.5" data-lon="-118.2" data-name="socal" data-display="Southern California (LA/Ventura)">üî• SoCal</button>
                        <button type="button" class="preset-btn" data-lat="37.8" data-lon="-122.2" data-name="norcal" data-display="Northern California (Bay Area)">üî• NorCal</button>
                        <button type="button" class="preset-btn" data-lat="45.5" data-lon="-122.6" data-name="pacific_nw" data-display="Oregon/Washington (Portland)">üå≤ Pacific NW</button>
                        <button type="button" class="preset-btn" data-lat="39.7" data-lon="-104.9" data-name="colorado" data-display="Colorado (Front Range)">‚õ∞Ô∏è Colorado</button>
                        <button type="button" class="preset-btn" data-lat="33.4" data-lon="-112.0" data-name="arizona" data-display="Arizona (Phoenix)">üèúÔ∏è Arizona</button>
                        <button type="button" class="preset-btn" data-lat="30.2" data-lon="-97.7" data-name="texas" data-display="Texas (Central)">ü§† Texas</button>
                    </div>
                </div>
                
                <form id="locationForm">
                    <div class="form-group">
                        <label for="latitude">Latitude</label>
                        <input type="number" id="latitude" step="0.0001" required placeholder="e.g., 33.1507">
                    </div>
                    <div class="form-group">
                        <label for="longitude">Longitude</label>
                        <input type="number" id="longitude" step="0.0001" required placeholder="e.g., -96.8236">
                    </div>
                    <div class="form-group">
                        <label for="areaName">Area Name (Optional)</label>
                        <input type="text" id="areaName" placeholder="e.g., Frisco, TX">
                    </div>
                    <button type="submit" id="analyzeBtn" class="btn-primary">
                        <span class="btn-text">Analyze Fire Risk</span>
                        <span class="btn-loader" style="display: none;">‚è≥ Analyzing...</span>
                    </button>
                </form>
            </div>

            <div id="results" class="results-section" style="display: none;">
                <h2>Risk Assessment Results</h2>
                
                <div class="freshness-indicators">
                    <div class="freshness-item">
                        <span class="freshness-icon">‚è∞</span>
                        <span class="freshness-text" id="weatherFreshness">Weather updated just now</span>
                    </div>
                    <div class="freshness-item">
                        <span class="freshness-icon">üìä</span>
                        <span class="freshness-text" id="rainFreshness">Rain history: last 90 days</span>
                    </div>
                </div>
                
                <div class="risk-summary">
                    <div class="risk-card" id="riskCard">
                        <div class="risk-level" id="riskLevel">-</div>
                        <div class="risk-label">Risk Level</div>
                    </div>
                    <div class="fdi-card" id="fdiCard">
                        <div class="fdi-value" id="fdiValue">-</div>
                        <div class="fdi-label">Fire Danger Index</div>
                        <div class="fdi-category" id="fdiCategory">-</div>
                    </div>
                </div>

                <div class="risk-explanation-card" id="riskExplanationCard">
                    <h3>‚ùì Why Is This The Risk?</h3>
                    <div class="explanation-content" id="riskExplanation"></div>
                </div>

                <!-- NASA FIRMS Active Fire Overlay Section -->
                <div class="detail-card firms-card" id="firmsCard" style="display: block;">
                    <h3>üõ∞Ô∏è NASA FIRMS Active Fires</h3>
                    <div class="detail-content" id="firmsContent">
                        <div class="firms-loading">Loading satellite fire data...</div>
                    </div>
                    <!-- Interactive Fire Map -->
                    <div id="firmsMapContainer" class="firms-map-container" style="display: block;">
                        <div id="firmsMap" class="firms-map"></div>
                        <div class="map-legend">
                            <div class="legend-item">
                                <span class="legend-marker" style="background-color: #FF0000;"></span>
                                <span>High Confidence</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-marker" style="background-color: #FFA500;"></span>
                                <span>Nominal Confidence</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-marker" style="background-color: #FFFF00;"></span>
                                <span>Low Confidence</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-marker" style="background-color: #4285F4;"></span>
                                <span>Your Location</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="details-grid">
                    <div class="detail-card">
                        <h3>üå§Ô∏è Weather Conditions <button id="weatherUnitToggle" class="unit-toggle" aria-label="Toggle units" title="Toggle units (¬∞C/¬∞F, km/h/mph)">Convert units</button></h3>
                        <div class="detail-content" id="weatherDetails"></div>
                    </div>
                    
                    <div class="detail-card">
                        <h3>üåßÔ∏è Rain History <button id="rainUnitToggle" class="unit-toggle" aria-label="Toggle rain units" title="Toggle rain units (mm/in)">Convert units</button></h3>
                        <div class="detail-content" id="rainDetails"></div>
                    </div>
                    
                    <div class="detail-card">
                        <h3>üèîÔ∏è Topography <button id="topoUnitToggle" class="unit-toggle" aria-label="Toggle topography units" title="Toggle elevation units (m/ft)">Convert units</button></h3>
                        <div class="detail-content" id="topographyDetails"></div>
                    </div>
                    
                    <div class="detail-card">
                        <h3>üë• Population & Infrastructure</h3>
                        <div class="detail-content" id="populationDetails"></div>
                    </div>
                    
                    <div class="detail-card">
                        <h3>üìä Classifications</h3>
                        <div class="detail-content" id="classificationsDetails"></div>
                    </div>
                    
                    <div class="detail-card">
                        <h3>üö® Recommendations</h3>
                        <div class="detail-content" id="recommendationsDetails"></div>
                    </div>
                </div>
            </div>

            <div id="error" class="error-message" style="display: none;"></div>
        </main>

        <!-- Chatbot Widget -->
        <div id="chatbot-container" class="chatbot-container">
            <button id="chatbot-toggle" class="chatbot-toggle">
                <span class="chatbot-icon">üí¨</span>
                <span class="chatbot-close-icon" style="display: none;">‚úñ</span>
            </button>
            
            <div id="chatbot-window" class="chatbot-window" style="display: none;">
                <div class="chatbot-header">
                    <h3>üî• FireGuard Assistant</h3>
                    <p>Ask me about fire safety calculations</p>
                </div>
                
                <div class="chatbot-messages" id="chatbot-messages">
                    <div class="chatbot-message bot-message">
                        <div class="message-content">
                            Hello! I'm your FireGuard Assistant. I can help you calculate:
                            <ul>
                                <li>Fireline Intensity</li>
                                <li>Flame Length</li>
                                <li>Safety Zone Distance</li>
                                <li>Burn Area Estimation</li>
                                <li>Escape Time</li>
                                <li>Risk Level Assessment</li>
                            </ul>
                            What would you like to know?
                        </div>
                    </div>
                </div>
                
                <div class="chatbot-quick-actions">
                    <button class="quick-action-btn" data-action="fireline_intensity">üî• Fireline Intensity</button>
                    <button class="quick-action-btn" data-action="flame_length">üìè Flame Length</button>
                    <button class="quick-action-btn" data-action="safety_zone">üõ°Ô∏è Safety Zone</button>
                    <button class="quick-action-btn" data-action="burn_area">üìä Burn Area</button>
                    <button class="quick-action-btn" data-action="escape_time">‚è±Ô∏è Escape Time</button>
                    <button class="quick-action-btn" data-action="risk_level">‚ö†Ô∏è Risk Level</button>
                </div>
                
                <div class="chatbot-input-area">
                    <input type="text" id="chatbot-input" class="chatbot-input" placeholder="Type your message...">
                    <button id="chatbot-send" class="chatbot-send-btn">Send</button>
                </div>
            </div>
        </div>

        <footer>
            <p>FireGuard - Powered by Python & Prolog</p>
        </footer>
    </div>

    <script src="/static/js/main.js"></script>
</body>
</html>

